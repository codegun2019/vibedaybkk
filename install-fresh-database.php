<?php
/**
 * ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• VIBEDAYBKK ‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
 * ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏ü‡∏•‡πå SQL ‡πÄ‡∏Å‡πà‡∏≤ - ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
 */

set_time_limit(600);
error_reporting(E_ALL);
ini_set('display_errors', 1);

// ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
function showMessage($type, $message) {
    $colors = [
        'success' => ['bg' => '#d4edda', 'text' => '#155724', 'border' => '#28a745'],
        'error' => ['bg' => '#f8d7da', 'text' => '#721c24', 'border' => '#dc3545'],
        'info' => ['bg' => '#d1ecf1', 'text' => '#0c5460', 'border' => '#17a2b8'],
        'warning' => ['bg' => '#fff3cd', 'text' => '#856404', 'border' => '#ffc107']
    ];
    $c = $colors[$type] ?? $colors['info'];
    echo "<div style='background: {$c['bg']}; color: {$c['text']}; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid {$c['border']};'>{$message}</div>";
    flush();
}

?>
<!DOCTYPE html>
<html><head>
<meta charset='UTF-8'>
<link href='https://fonts.googleapis.com/css2?family=Kanit:wght@400;600;700&display=swap' rel='stylesheet'>
<style>
body { font-family: 'Kanit', sans-serif; margin: 0; padding: 30px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; }
.container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
.header { background: linear-gradient(135deg, #DC2626 0%, #991b1b 100%); color: white; padding: 50px; text-align: center; }
.header h1 { font-size: 3rem; margin: 0; }
.content { padding: 40px; }
h2 { color: #DC2626; margin: 30px 0 15px 0; padding-bottom: 10px; border-bottom: 3px solid #DC2626; }
table { width: 100%; border-collapse: collapse; margin: 15px 0; background: white; border-radius: 8px; overflow: hidden; }
th { background: #DC2626; color: white; padding: 12px; text-align: left; }
td { padding: 10px; border-bottom: 1px solid #eee; }
tr:hover { background: #f8f9fa; }
</style>
</head>
<body>
<div class='container'>
<div class='header'>
<h1>üöÄ ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h1>
<p style='font-size: 1.2rem; margin-top: 10px; opacity: 0.9;'>VIBEDAYBKK - Fresh Install</p>
</div>
<div class='content'>

<?php

// ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠
showMessage('info', '<strong>üîå ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ MySQL...</strong>');

$socket = '/Applications/MAMP/tmp/mysql/mysql.sock';
$conn = new mysqli('localhost', 'root', 'root', '', 0, $socket);

if ($conn->connect_error) {
    showMessage('error', '‚ùå ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß: ' . $conn->connect_error);
    die('</div></div></body></html>');
}

showMessage('success', '‚úÖ ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! MySQL v' . $conn->server_info);

// ‡∏™‡∏≥‡∏£‡∏≠‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°
showMessage('info', '<strong>üì¶ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏°...</strong>');

$result = $conn->query("SHOW DATABASES LIKE 'vibedaybkk'");
if ($result && $result->num_rows > 0) {
    $backup = "vibedaybkk_backup_" . date('Ymd_His');
    $conn->query("CREATE DATABASE `{$backup}` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci");
    
    // ‡∏î‡∏∂‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞ BASE TABLE (‡πÑ‡∏°‡πà‡∏£‡∏ß‡∏° VIEW)
    $tables = [];
    $r = $conn->query("SELECT table_name FROM information_schema.tables WHERE table_schema = 'vibedaybkk' AND table_type = 'BASE TABLE'");
    while ($row = $r->fetch_array()) $tables[] = $row[0];
    
    $backupCount = 0;
    foreach ($tables as $t) {
        if (@$conn->query("CREATE TABLE `{$backup}`.`{$t}` LIKE `vibedaybkk`.`{$t}`")) {
            @$conn->query("INSERT INTO `{$backup}`.`{$t}` SELECT * FROM `vibedaybkk`.`{$t}`");
            $backupCount++;
        }
    }
    
    showMessage('success', "‚úÖ ‡∏™‡∏≥‡∏£‡∏≠‡∏á {$backupCount} ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô: <strong>{$backup}</strong>");
}

// ‡∏•‡∏ö‡πÅ‡∏•‡∏∞‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
showMessage('info', '<strong>üóÑÔ∏è ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà...</strong>');

$conn->query("DROP DATABASE IF EXISTS vibedaybkk");
$conn->query("CREATE DATABASE vibedaybkk CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci");
$conn->select_db('vibedaybkk');
$conn->set_charset('utf8mb4');

showMessage('success', '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• vibedaybkk ‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');

// ‡∏õ‡∏¥‡∏î foreign key checks
$conn->query("SET FOREIGN_KEY_CHECKS = 0");

echo "<h2>üìã ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á...</h2>";

// ==================== ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ====================

$tablesCreated = 0;

// 1. users
if ($conn->query("CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    password VARCHAR(255) NOT NULL,
    full_name VARCHAR(100) NOT NULL,
    email VARCHAR(100) NOT NULL,
    role ENUM('programmer', 'admin', 'editor', 'viewer') DEFAULT 'viewer',
    status ENUM('active', 'inactive') DEFAULT 'active',
    last_login DATETIME NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci")) {
    $tablesCreated++;
    showMessage('success', '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á users');
}

// Insert admin
$conn->query("INSERT INTO users (username, password, full_name, email, role) VALUES 
    ('admin', '\$2y\$10\$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi', '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö', 'admin@vibedaybkk.com', 'admin')");

// 2. roles
if ($conn->query("CREATE TABLE roles (
    id INT AUTO_INCREMENT PRIMARY KEY,
    role_key VARCHAR(50) NOT NULL UNIQUE,
    display_name VARCHAR(100) NOT NULL,
    description TEXT,
    level INT DEFAULT 0,
    icon VARCHAR(50) DEFAULT 'fa-user',
    color VARCHAR(100) DEFAULT 'bg-gray-600',
    price DECIMAL(10,2) DEFAULT 0.00,
    is_active TINYINT(1) DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci")) {
    $tablesCreated++;
    showMessage('success', '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á roles');
}

$conn->query("INSERT INTO roles (role_key, display_name, description, level, icon, color, price) VALUES
    ('programmer', '‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡πÄ‡∏°‡∏≠‡∏£‡πå', '‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î', 100, 'fa-code', 'bg-purple-600', 0),
    ('admin', '‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö', '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', 80, 'fa-user-shield', 'bg-red-600', 0),
    ('editor', '‡∏ö‡∏£‡∏£‡∏ì‡∏≤‡∏ò‡∏¥‡∏Å‡∏≤‡∏£', '‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤', 50, 'fa-edit', 'bg-yellow-500', 0),
    ('viewer', '‡∏ú‡∏π‡πâ‡∏ä‡∏°', '‡∏î‡∏π‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß', 10, 'fa-eye', 'bg-gray-500', 0)");

// 3. permissions
if ($conn->query("CREATE TABLE permissions (
    id INT AUTO_INCREMENT PRIMARY KEY,
    role_key VARCHAR(50) NOT NULL,
    feature VARCHAR(50) NOT NULL,
    can_view TINYINT(1) DEFAULT 0,
    can_create TINYINT(1) DEFAULT 0,
    can_edit TINYINT(1) DEFAULT 0,
    can_delete TINYINT(1) DEFAULT 0,
    can_export TINYINT(1) DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    UNIQUE KEY unique_role_feature (role_key, feature)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci")) {
    $tablesCreated++;
    showMessage('success', '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á permissions');
}

// Insert permissions
$features = ['models', 'categories', 'articles', 'article_categories', 'bookings', 'contacts', 'menus', 'users', 'gallery', 'settings', 'homepage'];
foreach ($features as $f) {
    $conn->query("INSERT IGNORE INTO permissions (role_key, feature, can_view, can_create, can_edit, can_delete, can_export) VALUES ('admin', '{$f}', 1, 1, 1, 1, 1)");
    $conn->query("INSERT IGNORE INTO permissions (role_key, feature, can_view, can_create, can_edit, can_delete, can_export) VALUES ('editor', '{$f}', 1, 1, 1, 0, 0)");
    $conn->query("INSERT IGNORE INTO permissions (role_key, feature, can_view, can_create, can_edit, can_delete, can_export) VALUES ('viewer', '{$f}', 1, 0, 0, 0, 0)");
}

// 4. settings
if ($conn->query("CREATE TABLE settings (
    id INT AUTO_INCREMENT PRIMARY KEY,
    setting_key VARCHAR(100) NOT NULL UNIQUE,
    setting_value TEXT,
    setting_type VARCHAR(50) DEFAULT 'text',
    category VARCHAR(50) DEFAULT 'general',
    description TEXT,
    is_public TINYINT(1) DEFAULT 1,
    sort_order INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci")) {
    $tablesCreated++;
    showMessage('success', '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á settings');
}

$conn->query("INSERT IGNORE INTO settings (setting_key, setting_value, category) VALUES
    ('site_name', 'VIBEDAY', 'general'),
    ('site_description', '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÅ‡∏•‡∏∞‡∏ô‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û', 'general'),
    ('site_logo', '', 'general'),
    ('site_favicon', '', 'general'),
    ('contact_phone', '02-123-4567', 'contact'),
    ('contact_email', 'info@vibedaybkk.com', 'contact'),
    ('social_facebook_enabled', '1', 'social'),
    ('social_facebook_url', 'https://facebook.com', 'social'),
    ('social_instagram_enabled', '1', 'social'),
    ('social_instagram_url', 'https://instagram.com', 'social'),
    ('social_line_enabled', '1', 'social'),
    ('social_line_url', '@vibedaybkk', 'social'),
    ('gototop_enabled', '1', 'general'),
    ('gototop_icon', 'fa-arrow-up', 'general'),
    ('gototop_bg_color', 'bg-red-primary', 'general')");

// 5. categories
if ($conn->query("CREATE TABLE categories (
    id INT AUTO_INCREMENT PRIMARY KEY,
    code VARCHAR(50) NOT NULL UNIQUE,
    name VARCHAR(100) NOT NULL,
    name_en VARCHAR(100),
    description TEXT,
    icon VARCHAR(50),
    color VARCHAR(50),
    gender ENUM('female', 'male', 'all') DEFAULT 'all',
    price_min DECIMAL(10,2),
    price_max DECIMAL(10,2),
    price_range VARCHAR(100),
    sort_order INT DEFAULT 0,
    is_active TINYINT(1) DEFAULT 1,
    status ENUM('active', 'inactive') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci")) {
    $tablesCreated++;
    showMessage('success', '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á categories');
}

$conn->query("INSERT INTO categories (code, name, name_en, description, icon, color, gender, price_min, price_max, price_range, sort_order) VALUES
    ('female-fashion', '‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô‡∏´‡∏ç‡∏¥‡∏á', 'Fashion Models', '‡∏á‡∏≤‡∏ô‡∏ñ‡πà‡∏≤‡∏¢‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô ‡πÅ‡∏Ñ‡∏ï‡∏ï‡∏≤‡∏•‡πá‡∏≠‡∏Å ‡∏£‡∏±‡∏ô‡πÄ‡∏ß‡∏¢‡πå', 'fa-female', 'from-pink-500 to-red-primary', 'female', 3000, 5000, '3,000-5,000 ‡∏ö‡∏≤‡∏ó/‡∏ß‡∏±‡∏ô', 1),
    ('female-photography', '‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏´‡∏ç‡∏¥‡∏á', 'Photography Models', '‡∏á‡∏≤‡∏ô‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤ ‡πÅ‡∏Ñ‡∏ï‡∏ï‡∏≤‡∏•‡πá‡∏≠‡∏Å', 'fa-camera', 'from-purple-500 to-pink-500', 'female', 2500, 4000, '2,500-4,000 ‡∏ö‡∏≤‡∏ó/‡∏ß‡∏±‡∏ô', 2),
    ('female-event', '‡∏ô‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏≠‡∏µ‡πÄ‡∏ß‡∏ô‡∏ï‡πå', 'Event Models', '‡∏á‡∏≤‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ ‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÇ‡∏ä‡∏ß‡πå', 'fa-star', 'from-red-primary to-red-light', 'female', 2000, 3500, '2,000-3,500 ‡∏ö‡∏≤‡∏ó/‡∏ß‡∏±‡∏ô', 3),
    ('male-fashion', '‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô‡∏ä‡∏≤‡∏¢', 'Male Fashion Models', '‡∏á‡∏≤‡∏ô‡∏ñ‡πà‡∏≤‡∏¢‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô‡∏ú‡∏π‡πâ‡∏ä‡∏≤‡∏¢', 'fa-male', 'from-blue-500 to-indigo-600', 'male', 3500, 6000, '3,500-6,000 ‡∏ö‡∏≤‡∏ó/‡∏ß‡∏±‡∏ô', 4),
    ('male-fitness', '‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ü‡∏¥‡∏ï‡πÄ‡∏ô‡∏™', 'Fitness Models', '‡∏á‡∏≤‡∏ô‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤‡∏ü‡∏¥‡∏ï‡πÄ‡∏ô‡∏™ ‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏°', 'fa-dumbbell', 'from-green-500 to-teal-600', 'male', 3000, 5000, '3,000-5,000 ‡∏ö‡∏≤‡∏ó/‡∏ß‡∏±‡∏ô', 5),
    ('male-business', '‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à', 'Business Models', '‡∏á‡∏≤‡∏ô‡πÇ‡∏Ü‡∏©‡∏ì‡∏≤‡∏ò‡∏∏‡∏£‡∏Å‡∏¥‡∏à ‡∏Ñ‡∏≠‡∏£‡πå‡∏õ‡∏≠‡πÄ‡∏£‡∏ï', 'fa-briefcase', 'from-orange-500 to-red-500', 'male', 2500, 4500, '2,500-4,500 ‡∏ö‡∏≤‡∏ó/‡∏ß‡∏±‡∏ô', 6)");

// 6. models
if ($conn->query("CREATE TABLE models (
    id INT AUTO_INCREMENT PRIMARY KEY,
    category_id INT NOT NULL,
    code VARCHAR(50) NOT NULL UNIQUE,
    name VARCHAR(100) NOT NULL,
    name_en VARCHAR(100),
    description TEXT,
    price_min DECIMAL(10,2),
    price_max DECIMAL(10,2),
    height INT,
    weight INT,
    bust INT,
    waist INT,
    hips INT,
    experience_years INT DEFAULT 0,
    age INT,
    skin_tone VARCHAR(50),
    hair_color VARCHAR(50),
    eye_color VARCHAR(50),
    languages TEXT,
    skills TEXT,
    featured TINYINT(1) DEFAULT 0,
    status ENUM('available', 'busy', 'inactive') DEFAULT 'available',
    view_count INT DEFAULT 0,
    booking_count INT DEFAULT 0,
    rating DECIMAL(3,2) DEFAULT 0.00,
    sort_order INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (category_id) REFERENCES categories(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci")) {
    $tablesCreated++;
    showMessage('success', '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á models');
}

// 7. homepage_sections
if ($conn->query("CREATE TABLE homepage_sections (
    id INT AUTO_INCREMENT PRIMARY KEY,
    section_key VARCHAR(50) NOT NULL UNIQUE,
    section_id VARCHAR(50),
    section_class TEXT,
    title TEXT,
    subtitle TEXT,
    content LONGTEXT,
    background_type ENUM('color', 'image', 'gradient') DEFAULT 'color',
    background_color VARCHAR(50),
    background_image VARCHAR(255),
    background_position VARCHAR(50) DEFAULT 'center',
    background_size VARCHAR(50) DEFAULT 'cover',
    background_repeat VARCHAR(50) DEFAULT 'no-repeat',
    background_attachment VARCHAR(50) DEFAULT 'scroll',
    left_image VARCHAR(255),
    button1_text VARCHAR(100),
    button1_link VARCHAR(255),
    button2_text VARCHAR(100),
    button2_link VARCHAR(255),
    is_active TINYINT(1) DEFAULT 1,
    sort_order INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci")) {
    $tablesCreated++;
    showMessage('success', '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á homepage_sections');
}

$conn->query("INSERT INTO homepage_sections (section_key, title, subtitle, button1_text, button1_link, button2_text, button2_link, is_active, sort_order) VALUES
    ('hero', 'VIBEDAYBKK', '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÅ‡∏•‡∏∞‡∏ô‡∏≤‡∏á‡πÅ‡∏ö‡∏ö‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û', '‡∏à‡∏≠‡∏á‡πÄ‡∏•‡∏¢', '#contact', '‡∏î‡∏π‡∏ú‡∏•‡∏á‡∏≤‡∏ô', '#services', 1, 1),
    ('about', '‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏£‡∏≤', '‡∏ó‡∏≥‡πÑ‡∏°‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏£‡∏≤', NULL, NULL, NULL, NULL, 1, 2),
    ('services', '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤', '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏´‡∏•‡∏≤‡∏Å‡∏´‡∏•‡∏≤‡∏¢', NULL, NULL, NULL, NULL, 1, 3),
    ('gallery', '‡∏ú‡∏•‡∏á‡∏≤‡∏ô', '‡πÅ‡∏Å‡∏•‡πÄ‡∏•‡∏≠‡∏£‡∏µ‡πà', NULL, NULL, NULL, NULL, 0, 4),
    ('testimonials', '‡∏£‡∏µ‡∏ß‡∏¥‡∏ß', '‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏à‡∏≤‡∏Å‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤', NULL, NULL, NULL, NULL, 1, 5),
    ('stats', '‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç', '‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ó‡∏µ‡πà‡∏ô‡πà‡∏≤‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö‡πÉ‡∏à', NULL, NULL, NULL, NULL, 0, 6),
    ('cta', 'Call to Action', '‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÇ‡∏õ‡∏£‡πÄ‡∏à‡∏Å‡∏ï‡πå', NULL, NULL, NULL, NULL, 0, 7),
    ('contact', '‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÄ‡∏£‡∏≤', '‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏™‡∏≠‡∏ö‡∏ñ‡∏≤‡∏°', NULL, NULL, NULL, NULL, 1, 8)");

// 8. articles
if ($conn->query("CREATE TABLE articles (
    id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    slug VARCHAR(255) NOT NULL UNIQUE,
    excerpt TEXT,
    content LONGTEXT NOT NULL,
    featured_image VARCHAR(255),
    category VARCHAR(100),
    category_id INT,
    author_id INT,
    read_time INT DEFAULT 5,
    view_count INT DEFAULT 0,
    status ENUM('draft', 'published', 'archived') DEFAULT 'draft',
    published_at DATETIME,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci")) {
    $tablesCreated++;
    showMessage('success', '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á articles');
}

// 9. article_categories
if ($conn->query("CREATE TABLE article_categories (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    slug VARCHAR(100) NOT NULL UNIQUE,
    description TEXT,
    icon VARCHAR(50),
    color VARCHAR(50),
    sort_order INT DEFAULT 0,
    status ENUM('active', 'inactive') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci")) {
    $tablesCreated++;
    showMessage('success', '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á article_categories');
}

$conn->query("INSERT INTO article_categories (name, slug, icon, color) VALUES
    ('‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô', 'fashion', 'fa-tshirt', 'from-pink-500 to-red-500'),
    ('‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û', 'photography', 'fa-camera', 'from-blue-500 to-purple-500'),
    ('‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö', 'tips', 'fa-lightbulb', 'from-yellow-500 to-orange-500')");

// 10. bookings
if ($conn->query("CREATE TABLE bookings (
    id INT AUTO_INCREMENT PRIMARY KEY,
    model_id INT NOT NULL,
    customer_name VARCHAR(100) NOT NULL,
    customer_email VARCHAR(100) NOT NULL,
    customer_phone VARCHAR(20) NOT NULL,
    booking_date DATE NOT NULL,
    booking_days INT DEFAULT 1,
    service_type VARCHAR(100),
    location TEXT,
    message TEXT,
    total_price DECIMAL(10,2),
    status ENUM('pending', 'confirmed', 'cancelled', 'completed') DEFAULT 'pending',
    payment_status ENUM('unpaid', 'deposit', 'paid', 'refunded') DEFAULT 'unpaid',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (model_id) REFERENCES models(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci")) {
    $tablesCreated++;
    showMessage('success', '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á bookings');
}

// 11. contacts
if ($conn->query("CREATE TABLE contacts (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    email VARCHAR(100) NOT NULL,
    phone VARCHAR(20),
    service_type VARCHAR(100),
    message TEXT NOT NULL,
    status ENUM('new', 'read', 'replied', 'closed') DEFAULT 'new',
    ip_address VARCHAR(45),
    user_agent TEXT,
    replied_at DATETIME,
    replied_by INT,
    reply_message TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci")) {
    $tablesCreated++;
    showMessage('success', '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á contacts');
}

// 12. customer_reviews
if ($conn->query("CREATE TABLE customer_reviews (
    id INT AUTO_INCREMENT PRIMARY KEY,
    customer_name VARCHAR(100),
    image VARCHAR(255),
    rating INT DEFAULT 5,
    content TEXT,
    is_active TINYINT(1) DEFAULT 1,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci")) {
    $tablesCreated++;
    showMessage('success', '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á customer_reviews');
}

$conn->query("INSERT INTO customer_reviews (customer_name, rating, content) VALUES
    ('‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ', 5, '‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏°‡∏∑‡∏≠‡∏≠‡∏≤‡∏ä‡∏µ‡∏û ‡∏õ‡∏£‡∏∞‡∏ó‡∏±‡∏ö‡πÉ‡∏à‡∏Ñ‡∏£‡∏±‡∏ö'),
    ('‡∏Ñ‡∏∏‡∏ì‡∏™‡∏°‡∏´‡∏ç‡∏¥‡∏á ‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°', 5, '‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏™‡∏ß‡∏¢ ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ‡∏°‡∏≤‡∏Å ‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡πÄ‡∏•‡∏¢‡∏Ñ‡πà‡∏∞'),
    ('‡∏Ñ‡∏∏‡∏ì‡∏ß‡∏¥‡∏†‡∏≤ ‡πÄ‡∏à‡∏£‡∏¥‡∏ç', 4, '‡∏£‡∏≤‡∏Ñ‡∏≤‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏™‡∏° ‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û‡∏î‡∏µ')");

// 13. menus
if ($conn->query("CREATE TABLE menus (
    id INT AUTO_INCREMENT PRIMARY KEY,
    parent_id INT NULL,
    title VARCHAR(100) NOT NULL,
    url VARCHAR(255) NOT NULL,
    icon VARCHAR(50),
    target VARCHAR(20) DEFAULT '_self',
    sort_order INT DEFAULT 0,
    status ENUM('active', 'inactive') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci")) {
    $tablesCreated++;
    showMessage('success', '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á menus');
}

$conn->query("INSERT INTO menus (title, url, icon, sort_order) VALUES
    ('‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö', 'index.php#about', 'fa-info-circle', 1),
    ('‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£', 'index.php#services', 'fa-briefcase', 2),
    ('‡∏ú‡∏•‡∏á‡∏≤‡∏ô', 'gallery.php', 'fa-images', 3),
    ('‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°', 'articles.php', 'fa-newspaper', 4),
    ('‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠', 'index.php#contact', 'fa-envelope', 5)");

// 14. gallery_albums
if ($conn->query("CREATE TABLE gallery_albums (
    id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    description TEXT,
    cover_image VARCHAR(255),
    sort_order INT DEFAULT 0,
    is_active TINYINT(1) DEFAULT 1,
    view_count INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci")) {
    $tablesCreated++;
    showMessage('success', '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á gallery_albums');
}

// 15. gallery_images
if ($conn->query("CREATE TABLE gallery_images (
    id INT AUTO_INCREMENT PRIMARY KEY,
    album_id INT NOT NULL,
    image_path VARCHAR(255) NOT NULL,
    thumbnail_path VARCHAR(255),
    title VARCHAR(255),
    description TEXT,
    sort_order INT DEFAULT 0,
    view_count INT DEFAULT 0,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (album_id) REFERENCES gallery_albums(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci")) {
    $tablesCreated++;
    showMessage('success', '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á gallery_images');
}

// 16. activity_logs
if ($conn->query("CREATE TABLE activity_logs (
    id INT AUTO_INCREMENT PRIMARY KEY,
    user_id INT,
    action VARCHAR(100) NOT NULL,
    table_name VARCHAR(50),
    record_id INT,
    old_values TEXT,
    new_values TEXT,
    ip_address VARCHAR(45),
    user_agent TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci")) {
    $tablesCreated++;
    showMessage('success', '‚úÖ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á activity_logs');
}

// ‡πÄ‡∏õ‡∏¥‡∏î foreign key ‡πÉ‡∏´‡∏°‡πà
$conn->query("SET FOREIGN_KEY_CHECKS = 1");

showMessage('info', "üìä ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <strong>{$tablesCreated} ‡∏ï‡∏≤‡∏£‡∏≤‡∏á</strong>");

// ==================== ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏• ====================
echo "<h2>üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</h2>";

$tables = [];
$result = $conn->query("SHOW TABLES");
while ($row = $result->fetch_array()) $tables[] = $row[0];

echo "<table><tr><th>#</th><th>‡∏ï‡∏≤‡∏£‡∏≤‡∏á</th><th>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</th></tr>";
$totalRecords = 0;
foreach ($tables as $idx => $t) {
    $c = $conn->query("SELECT COUNT(*) as cnt FROM `{$t}`")->fetch_assoc();
    $totalRecords += $c['cnt'];
    echo "<tr><td>" . ($idx+1) . "</td><td><strong>{$t}</strong></td><td>" . number_format($c['cnt']) . "</td></tr>";
}
echo "</table>";

showMessage('info', "üìä ‡∏ï‡∏≤‡∏£‡∏≤‡∏á: <strong>" . count($tables) . "</strong> | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: <strong>{$totalRecords} records</strong>");

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö admin
$admin = $conn->query("SELECT username, role FROM users WHERE role IN ('admin', 'programmer') LIMIT 1");
if ($admin && $admin->num_rows > 0) {
    $a = $admin->fetch_assoc();
    showMessage('success', "‚úÖ Admin: <strong>{$a['username']}</strong> ({$a['role']})");
}

// ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö roles & permissions
$rolesCount = $conn->query("SELECT COUNT(*) as c FROM roles")->fetch_assoc()['c'];
$permsCount = $conn->query("SELECT COUNT(*) as c FROM permissions")->fetch_assoc()['c'];

showMessage('info', "üë• Roles: <strong>{$rolesCount}</strong> | üîê Permissions: <strong>{$permsCount}</strong>");

// ‡∏™‡∏£‡∏∏‡∏õ
echo "<h2>‚ú® ‡∏™‡∏£‡∏∏‡∏õ</h2>";

if (count($tables) >= 15 && $totalRecords >= 20) {
    echo "<div style='background: #d4edda; color: #155724; padding: 50px; border-radius: 15px; text-align: center; margin: 30px 0;'>";
    echo "<h2 style='color: #155724; font-size: 2.5rem; margin: 0 0 30px 0;'>üéâ ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!</h2>";
    echo "<p style='font-size: 1.3rem; margin: 15px 0;'>‚úÖ ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</p>";
    echo "<p style='font-size: 1.1rem;'>‡∏ï‡∏≤‡∏£‡∏≤‡∏á: <strong>" . count($tables) . "</strong> | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: <strong>{$totalRecords}</strong></p>";
    
    echo "<div style='margin-top: 40px; display: grid; grid-template-columns: 1fr 1fr; gap: 20px;'>";
    echo "<a href='verify-database-structure.php' style='padding: 25px; background: #17a2b8; color: white; text-decoration: none; border-radius: 12px; font-size: 1.1rem; font-weight: 600;'>üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö DB</a>";
    echo "<a href='admin/' style='padding: 25px; background: #DC2626; color: white; text-decoration: none; border-radius: 12px; font-size: 1.1rem; font-weight: 600;'>üë®‚Äçüíº Admin Panel</a>";
    echo "<a href='test-connection-all.php' style='padding: 25px; background: #28a745; color: white; text-decoration: none; border-radius: 12px; font-size: 1.1rem; font-weight: 600;'>‚úÖ Test Connection</a>";
    echo "<a href='index.php' style='padding: 25px; background: #6f42c1; color: white; text-decoration: none; border-radius: 12px; font-size: 1.1rem; font-weight: 600;'>üè† Frontend</a>";
    echo "</div>";
    
    echo "<div style='margin-top: 30px; padding: 25px; background: #fff3cd; border-radius: 12px;'>";
    echo "<h3 style='margin: 0 0 15px 0; color: #856404;'>üë§ ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h3>";
    echo "<p style='font-size: 1.2rem; margin: 0;'>";
    echo "Username: <strong style='color: #DC2626;'>admin</strong><br>";
    echo "Password: <strong style='color: #DC2626;'>admin123</strong>";
    echo "</p>";
    echo "</div>";
    echo "</div>";
} else {
    showMessage('warning', "‚ö†Ô∏è ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÅ‡∏•‡πâ‡∏ß ‡πÅ‡∏ï‡πà‡∏≠‡∏≤‡∏à‡πÑ‡∏°‡πà‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå<br>‡∏ï‡∏≤‡∏£‡∏≤‡∏á: " . count($tables) . " | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: {$totalRecords}");
}

$conn->close();

?>

</div>
</div>
</body>
</html>

